# from scipy.optimize import curve_fit
import matplotlib.pyplot as plt
import numpy as np
from skimage.draw import circle
from skimage.color import gray2rgb

micron_per_pixel = 410 / 1462.357  # micron / pixel

default_path = "C:\\Users\\Sumita\\Documents\\Research\\Microspheres\\birefringent measurements\\sphere images\\"
default_path = default_path + '2019-05_measurements\\'

folder_name_list = ['alumina_birefringence',
                    'corpuscular_silica_15um_birefringence',
                    'corpuscular_silica_15um_birefringence_2',
                    'gadi_vaterite_birefringence',
                    'gadi_vaterite_birefringence_2',
                    'german_8um_vaterite_birefringence',
                    'german_8um_vaterite_birefringence_2',
                    'german_11um_vaterite_birefringence',
                    'german_11um_vaterite_birefringence_2',
                    'german_11um_vaterite_birefringence_3',
                    'german_22um_silica_birefringence',
                    ]

sphere_labels = ['Alumina', '15um Corpuscular silica', 'House-made vaterite', '8um microParticles vaterite',
                 '11um microParticles vaterite', '22um microParticles silica']

# marker_list = ['o', 's', '*', '^', 'v', 'd', '1', '+', 'x']

save_images = True
fit = True

debugging = False  # only using the single sphere

# alumina_spheres = [[7.694520052, 127, 12],
#                    [9.009385161, 74, 27],
#                    [11.22723096, 127, 28],
#                    [9.079772052, 101, 40],
#                    [8.61198023, 323, 68],
#                    [7.81764019, 319, 81],
#                    [7.938851143, 507, 85],
#                    [13.30339418, 564, 126],
#                    [7.312732791, 250, 131],
#                    [7.506054213, 242, 139],
#                    [11.14185153, 733, 141],
#                    [7.653039857, 96, 144],
#                    [8.349243383, 239, 150],
#                    [6.128667602, 249, 152],
#                    [8.11727457, 741, 153],
#                    [6.932877672, 101, 157],
#                    [6.102643418, 500, 159],
#                    [11.18462271, 675, 164],
#                    [8.291859587, 192, 167],
#                    [11.18462271, 584, 175],
#                    [8.500373178, 679, 178],
#                    [12.03457512, 479, 203],
#                    [11.08456657, 213, 212],
#                    [8.481629223, 302, 226],
#                    [10.07674817, 669, 236],
#                    [8.097643889, 660, 247],
#                    [8.630441088, 663, 259],
#                    [10.98359899, 150, 266],
#                    [6.383076486, 474, 271],
#                    [8.349243383, 359, 275],
#                    [11.53488329, 93, 295],
#                    [14.22831992, 357, 310],
#                    [14.10473959, 718, 332],
#                    [8.519075892, 603, 332],
#                    [4.478115991, 344, 337],
#                    [7.776816725, 610, 342],
#                    [7.611333608, 722, 368],
#                    [8.685588237, 484, 379],
#                    [8.018640596, 418, 410],
#                    [8.23407589, 153, 443],
#                    [7.673807982, 395, 467],
#                    ]
# alumina_measure = [[3.141274657, 128, 12],
#                    [3.191538243, 76, 27],
#                    [3.141274657, 129, 28],
#                    [3.191538243, 103, 41],
#                    [2.763953196, 324, 69],
#                    [2.763953196, 319, 81],
#                    [2.585441473, 507, 85],
#                    [3.742410319, 565, 126],
#                    [2.763953196, 251, 131],
#                    [3.03825389, 242, 139],
#                    [3.141274657, 734, 141],
#                    [3.241022407, 97, 144],
#                    [3.03825389, 238, 150],
#                    [2.585441473, 249, 152],
#                    [2.646283714, 742, 154],
#                    [2.763953196, 102, 157],
#                    [2.523132522, 500, 158],
#                    [2.985410661, 676, 164],
#                    [2.985410661, 193, 168],
#                    [2.985410661, 584, 175],
#                    [2.763953196, 680, 179],
#                    [3.568248232, 480, 203],
#                    [4.513516668, 214, 212],
#                    [2.985410661, 303, 226],
#                    [3.826519929, 671, 237],
#                    [2.985410661, 660, 247],
#                    [3.241022407, 663, 260],
#                    [4.652426492, 150, 266],
#                    [2.326213246, 474, 271],
#                    [2.931615071, 359, 276],
#                    [5.014626707, 93, 294],
#                    [4.950743503, 358, 310],
#                    [4.886025119, 719, 332],
#                    [3.241022407, 603, 332],
#                    [1.128379167, 343, 338],
#                    [2.820947918, 610, 342],
#                    [2.523132522, 722, 368],
#                    [4.259537946, 484, 379],
#                    [4.068428945, 418, 410],
#                    [4.406461512, 153, 443],
#                    [4.068428945, 395, 467],
#                    ]
#
# corp151_spheres = [[17.26088218, 323, 13],
#                    [22.91054347, 489, 14],
#                    [22.4260924, 401, 17],
#                    [22.93831384, 444, 25],
#                    [29.72588508, 705, 25],
#                    [23.13177293, 653, 29],
#                    [25.45739437, 248, 33],
#                    [24.77942232, 297, 50],
#                    [29.64546501, 91, 52],
#                    [22.99375396, 36, 53],
#                    [25.97111181, 720, 70],
#                    [23.80318461, 136, 75],
#                    [26.33623439, 682, 75],
#                    [28.59055417, 178, 100],
#                    [34.9843038, 90, 116],
#                    [19.94711402, 285, 118],
#                    [23.72952146, 19, 121],
#                    [28.76813696, 351, 135],
#                    [27.55302304, 627, 148],
#                    [25.19976633, 473, 149],
#                    [24.77942232, 40, 171],
#                    [30.81942083, 31, 239],
#                    [19.77080019, 104, 240],
#                    [35.44080714, 421, 247],
#                    [24.94585792, 644, 252],
#                    [25.29432488, 339, 265],
#                    [30.36681973, 281, 295],
#                    [28.01131681, 229, 303],
#                    [24.81151587, 671, 303],
#                    [26.1360482, 439, 304],
#                    [26.45080584, 87, 329],
#                    [31.7954745, 595, 332],
#                    [24.07576173, 527, 347],
#                    [22.96605063, 337, 348],
#                    [27.92025987, 670, 353],
#                    [24.76657325, 381, 353],
#                    [21.67545598, 626, 373],
#                    [28.13603893, 314, 389],
#                    [25.86672343, 409, 393],
#                    [18.12445317, 740, 394],
#                    [35.82937023, 553, 394],
#                    [21.66076574, 358, 406],
#                    [25.49487767, 256, 417],
#                    [26.11167892, 194, 417],
#                    [22.91748922, 629, 425],
#                    [24.11539264, 706, 440],
#                    [24.48218772, 405, 445],
#                    [20.69891559, 511, 451],
#                    [24.00293511, 306, 454],
#                    [28.02835705, 213, 460],
#                    [24.22732817, 23, 460],
#                    [22.51816264, 445, 465],
#                    [19.682051, 560, 467],
#                    ]
# corp151_measure = [[8.214724333, 326, 10],
#                    [14.96964127, 492, 10],
#                    [15.31647434, 405, 16],
#                    [12.55242581, 444, 25],
#                    [17.58969043, 708, 26],
#                    [8.667244841, 655, 31],
#                    [13.83127766, 252, 35],
#                    [13.33923635, 301, 51],
#                    [17.5987363, 96, 52],
#                    [10.49453289, 40, 54],
#                    [18.28183198, 724, 71],
#                    [11.71288013, 140, 76],
#                    [11.83454055, 683, 77],
#                    [20.97389479, 182, 102],
#                    [24.25359086, 95, 118],
#                    [6.102643418, 286, 119],
#                    [13.70411737, 18, 122],
#                    [17.05682374, 355, 137],
#                    [14.57095378, 630, 149],
#                    [12.2962269, 476, 150],
#                    [14.84151075, 45, 172],
#                    [18.93190249, 34, 240],
#                    [7.20309041, 107, 240],
#                    [26.58883708, 426, 249],
#                    [8.593479714, 644, 254],
#                    [14.05953197, 342, 266],
#                    [23.31680265, 282, 296],
#                    [16.35176762, 234, 304],
#                    [11.63106623, 674, 306],
#                    [15.30607971, 442, 304],
#                    [15.40971042, 90, 329],
#                    [21.11757918, 598, 332],
#                    [13.17113845, 531, 348],
#                    [9.236181543, 342, 350],
#                    [15.42003518, 673, 353],
#                    [15.06502402, 385, 353],
#                    [8.23407589, 629, 373],
#                    [17.28852172, 317, 390],
#                    [13.78517327, 413, 394],
#                    [10.29549378, 744, 395],
#                    [30.10891157, 555, 395],
#                    [9.079772052, 361, 409],
#                    [13.91159268, 260, 417],
#                    [14.60368528, 198, 417],
#                    [6.603669768, 631, 425],
#                    [9.57461473, 708, 444],
#                    [13.46984169, 409, 445],
#                    [7.715176519, 512, 450],
#                    [13.69249878, 310, 456],
#                    [21.99615937, 216, 464],
#                    [18.8729638, 23, 465],
#                    [16.58371917, 449, 469],
#                    [9.657370069, 563, 472],
#                    ]
#
# corp152_spheres = [[12.76615297, 16, 8],
#                    [25.13652967, 421, 35],
#                    [26.6784727, 226, 38],
#                    [24.65063027, 35, 87],
#                    [26.40262583, 491, 92],
#                    [20.61416256, 299, 129],
#                    [25.66287502, 431, 144],
#                    [23.88994822, 161, 146],
#                    [22.4260924, 190, 180],
#                    [26.69040137, 94, 185],
#                    [19.78689364, 344, 196],
#                    [34.84298934, 719, 234],
#                    [29.77937781, 613, 323],
#                    [25.59456477, 406, 460],
#                    [14.7662545, 499, 472],
#                    ]
# corp152_measure = [[8.330159374, 17, 4],
#                    [19.51965506, 420, 34],
#                    [20.8521295, 227, 37],
#                    [18.29053554, 34, 85],
#                    [20.84449555, 492, 91],
#                    [14.63634358, 298, 127],
#                    [20.15349634, 432, 144],
#                    [18.17706417, 161, 144],
#                    [17.3986408, 191, 178],
#                    [22.22649193, 95, 184],
#                    [12.81592374, 344, 195],
#                    [31.00477151, 718, 235],
#                    [24.1417771, 614, 322],
#                    [19.0492328, 406, 460],
#                    [11.69928421, 499, 473],
#                    ]
#
# gadi_1__spheres = [[4.950743503, 191, 37],
#                    [2.646283714, 639, 45],
#                    [11.49341563, 91, 69],
#                    [3.03825389, 288, 80],
#                    [10.10828737, 284, 98],
#                    [12.02134303, 252, 166],
#                    [5.917270273, 262, 204],
#                    [5.890312181, 122, 249],
#                    [8.11727457, 387, 371],
#                    [8.830963827, 418, 438],
#                    ]
# gadi_1__measure = [[10.04510995, 192, 36],
#                    [8.444016491, 641, 43],
#                    [16.47781335, 92, 70],
#                    [5.41151638, 288, 79],
#                    [17.46255626, 287, 100],
#                    [19.37233481, 253, 167],
#                    [12.06099573, 261, 204],
#                    [11.25554684, 122, 250],
#                    [12.91488987, 386, 370],
#                    [13.79671381, 418, 438],
#                    ]
#
# gadi_2__spheres = [[15.84760235, 172, 20],
#                    [16.8597369, 484, 58],
#                    [19.15753895, 310, 69],
#                    [8.593479714, 380, 63],
#                    [13.63425735, 183, 126],
#                    [8.519075892, 359, 122],
#                    [18.98227571, 632, 138],
#                    [18.70354418, 133, 147],
#                    [10.18670815, 25, 186],
#                    [19.43794832, 367, 203],
#                    [17.37117647, 133, 209],
#                    [9.80456963, 697, 230],
#                    [10.35714399, 192, 256],
#                    [12.41217084, 138, 258],
#                    [15.83755632, 144, 281],
#                    [20.54455911, 689, 291],
#                    [16.90687073, 188, 298],
#                    [16.34203153, 62, 308],
#                    [10.61516367, 744, 352],
#                    [14.07084749, 519, 365],
#                    [18.62680262, 114, 379],
#                    [17.21471766, 380, 379],
#                    [20.3264909, 352, 411],
#                    [18.18581787, 459, 434],
#                    [16.76507171, 116, 430],
#                    [14.78779537, 335, 441],
#                    [21.24531522, 228, 463],
#                    ]
# gadi_2__measure = [[5.670035141, 174, 19],
#                    [8.214724333, 484, 57],
#                    [11.47955979, 310, 68],
#                    [1.871205159, 380, 64],
#                    [7.858251582, 184, 126],
#                    [3.431831259, 358, 122],
#                    [11.50725478, 632, 136],
#                    [10.21790794, 133, 144],
#                    [3.742410319, 27, 186],
#                    [10.20231997, 369, 205],
#                    [9.166995688, 132, 208],
#                    [3.477898169, 696, 229],
#                    [2.034214473, 193, 255],
#                    [5.890312181, 141, 258],
#                    [10.26452982, 144, 278],
#                    [13.96867783, 689, 290],
#                    [11.4100282, 190, 296],
#                    [9.11476167, 65, 306],
#                    [4.107362167, 745, 353],
#                    [8.630441088, 519, 365],
#                    [11.25554684, 114, 378],
#                    [10.86705884, 380, 382],
#                    [13.91159268, 351, 411],
#                    [9.457540802, 461, 436],
#                    [7.878478775, 121, 429],
#                    [6.770275003, 335, 439],
#                    [11.17038385, 230, 461],
#                    ]
#
# ger8um1_spheres = [[16.58371917, 388, 14],
#                    [16.62206309, 570, 15],
#                    [17.02880813, 258, 17],
#                    [17.56252487, 55, 19],
#                    [16.42944867, 674, 22],
#                    [17.00074636, 223, 27],
#                    [17.22396046, 93, 27],
#                    [16.93508806, 20, 32],
#                    [17.8144592, 137, 33],
#                    [17.54439112, 462, 35],
#                    [17.6168141, 646, 40],
#                    [17.29772508, 591, 40],
#                    [17.34366866, 690, 51],
#                    [17.2331983, 548, 51],
#                    [16.29326379, 49, 54],
#                    [16.51640313, 83, 59],
#                    [17.94796938, 170, 65],
#                    [15.69623687, 728, 64],
#                    [17.90357661, 383, 69],
#                    [17.58063991, 468, 68],
#                    [17.22396046, 596, 73],
#                    [17.0847934, 435, 76],
#                    [17.20546989, 650, 81],
#                    [17.38949085, 314, 86],
#                    [20.75266913, 47, 89],
#                    [16.38094118, 713, 93],
#                    [16.30302901, 271, 96],
#                    [16.94448339, 409, 98],
#                    [17.88578865, 570, 103],
#                    [17.76077412, 445, 106],
#                    [17.8144592, 524, 112],
#                    [17.71591228, 203, 113],
#                    [17.46255626, 639, 116],
#                    [16.11647812, 322, 117],
#                    [16.7935273, 383, 117],
#                    [18.14200712, 725, 125],
#                    [17.36201204, 255, 124],
#                    [16.73656774, 685, 125],
#                    [17.2424312, 468, 127],
#                    [17.89468484, 139, 128],
#                    [11.56244577, 21, 128],
#                    [17.53531722, 178, 140],
#                    [14.83078323, 393, 145],
#                    [15.66578827, 659, 147],
#                    [16.53566425, 496, 152],
#                    [17.48077489, 20, 154],
#                    [16.55490296, 692, 157],
#                    [16.95387352, 151, 160],
#                    [18.22952334, 320, 164],
#                    [17.10341444, 287, 172],
#                    [16.96325845, 650, 177],
#                    [17.64389607, 508, 182],
#                    [16.42944867, 573, 183],
#                    [17.76973289, 541, 187],
#                    [17.34366866, 683, 187],
#                    [16.37122244, 628, 200],
#                    [14.83078323, 171, 201],
#                    [17.48077489, 295, 204],
#                    [17.43519261, 480, 204],
#                    [17.01945935, 142, 212],
#                    [17.38949085, 564, 214],
#                    [17.73387063, 234, 216],
#                    [15.84760235, 267, 219],
#                    [16.42944867, 683, 219],
#                    [17.47166795, 114, 230],
#                    [17.14059582, 178, 232],
#                    [17.52623862, 376, 237],
#                    [17.16842901, 489, 236],
#                    [14.61457949, 547, 240],
#                    [16.68895295, 704, 246],
#                    [16.38094118, 673, 250],
#                    [17.67994084, 438, 259],
#                    [17.28852172, 611, 264],
#                    [17.63487337, 501, 268],
#                    [17.79658216, 384, 269],
#                    [16.55490296, 578, 269],
#                    [17.10341444, 725, 271],
#                    [17.05682374, 545, 270],
#                    [16.8597369, 641, 275],
#                    [16.77456227, 352, 281],
#                    [15.12827843, 321, 280],
#                    [16.95387352, 674, 281],
#                    [17.44431859, 161, 283],
#                    [16.72705563, 239, 284],
#                    [17.07547527, 595, 299],
#                    [17.37117647, 89, 300],
#                    [17.17769672, 191, 300],
#                    [17.04749032, 556, 301],
#                    [17.36201204, 717, 304],
#                    [16.89745448, 495, 309],
#                    [13.58748446, 313, 306],
#                    [17.56252487, 342, 313],
#                    [17.35284277, 425, 314],
#                    [17.76973289, 678, 314],
#                    [16.82193475, 458, 314],
#                    [16.89745448, 114, 321],
#                    [17.62584605, 33, 322],
#                    [17.54439112, 147, 324],
#                    [17.40778595, 211, 327],
#                    [16.69848677, 578, 326],
#                    [16.84084643, 543, 331],
#                    [17.60777752, 390, 335],
#                    [16.18545756, 257, 338],
#                    [17.35284277, 486, 341],
#                    [17.48987709, 356, 343],
#                    [15.80737994, 443, 343],
#                    [17.17769672, 323, 350],
#                    [16.17562136, 229, 353],
#                    [16.83139325, 566, 355],
#                    [17.04749032, 277, 364],
#                    [17.43519261, 95, 364],
#                    [17.65291417, 643, 364],
#                    [17.32530585, 404, 366],
#                    [17.16842901, 207, 377],
#                    [16.77456227, 130, 376],
#                    [16.95387352, 364, 377],
#                    [16.78404746, 247, 380],
#                    [16.31278838, 333, 381],
#                    [16.90687073, 303, 381],
#                    [17.76077412, 484, 386],
#                    [16.63163525, 160, 389],
#                    [16.80300179, 631, 395],
#                    [15.35798247, 697, 396],
#                    [16.85029431, 101, 404],
#                    [16.46815178, 226, 404],
#                    [17.6168141, 134, 410],
#                    [16.68895295, 171, 420],
#                    [16.95387352, 678, 423],
#                    [17.37117647, 32, 424],
#                    [17.16842901, 429, 426],
#                    [17.55346034, 68, 427],
#                    [15.82750392, 639, 427],
#                    [17.2424312, 712, 428],
#                    [16.65076307, 214, 433],
#                    [17.70692627, 477, 439],
#                    [17.65291417, 608, 441],
#                    [15.62509785, 552, 448],
#                    [16.97263819, 413, 454],
#                    [17.20546989, 39, 459],
#                    [16.76507171, 681, 456],
#                    [15.08613829, 232, 459],
#                    [16.26393296, 173, 467],
#                    ]
# ger8um1_measure = [[8.884866447, 388, 10],
#                    [8.740387445, 571, 13],
#                    [8.311031543, 260, 16],
#                    [7.653039857, 58, 20],
#                    [8.537737636, 674, 23],
#                    [7.797255175, 225, 26],
#                    [8.175883811, 94, 26],
#                    [7.878478775, 21, 34],
#                    [8.038464212, 138, 33],
#                    [8.991702347, 463, 34],
#                    [8.848967849, 646, 38],
#                    [9.044647077, 592, 39],
#                    [8.758577657, 690, 50],
#                    [8.593479714, 548, 50],
#                    [7.463526652, 51, 52],
#                    [7.878478775, 83, 58],
#                    [8.574939283, 171, 65],
#                    [7.590394548, 729, 64],
#                    [9.097283683, 382, 68],
#                    [9.027033337, 469, 67],
#                    [9.027033337, 595, 72],
#                    [9.184341013, 435, 76],
#                    [9.009385161, 649, 80],
#                    [8.920620581, 314, 86],
#                    [10.68986666, 47, 88],
#                    [8.214724333, 715, 93],
#                    [8.406235467, 271, 96],
#                    [9.149617482, 409, 97],
#                    [9.440697439, 570, 101],
#                    [11.45179781, 445, 106],
#                    [9.009385161, 524, 111],
#                    [8.776730169, 203, 113],
#                    [9.287732724, 638, 114],
#                    [7.797255175, 323, 115],
#                    [8.330159374, 384, 117],
#                    [9.287732724, 726, 124],
#                    [8.556358678, 256, 123],
#                    [8.11727457, 685, 124],
#                    [8.272643201, 468, 127],
#                    [8.462843753, 140, 128],
#                    [5.170882946, 22, 127],
#                    [8.758577657, 179, 139],
#                    [6.530966601, 394, 145],
#                    [8.758577657, 659, 146],
#                    [8.368283872, 496, 152],
#                    [9.009385161, 20, 153],
#                    [8.938444016, 691, 155],
#                    [8.830963827, 151, 158],
#                    [8.500373178, 321, 165],
#                    [8.884866447, 288, 172],
#                    [9.184341013, 650, 177],
#                    [9.201653641, 508, 182],
#                    [8.703892975, 572, 182],
#                    [9.270580849, 541, 187],
#                    [9.027033337, 683, 187],
#                    [8.330159374, 628, 199],
#                    [7.938851143, 171, 201],
#                    [9.253397181, 295, 203],
#                    [9.132206206, 480, 204],
#                    [7.797255175, 144, 213],
#                    [9.079772052, 564, 213],
#                    [8.794845214, 234, 215],
#                    [7.99876785, 267, 218],
#                    [8.776730169, 682, 220],
#                    [8.703892975, 115, 229],
#                    [8.830963827, 178, 230],
#                    [9.356025796, 376, 236],
#                    [9.3219418, 489, 236],
#                    [7.735777828, 547, 239],
#                    [8.866935315, 703, 246],
#                    [9.836981519, 674, 250],
#                    [9.3219418, 437, 259],
#                    [8.956231982, 611, 263],
#                    [9.57461473, 500, 267],
#                    [8.462843753, 382, 268],
#                    [9.373021316, 579, 270],
#                    [9.287732724, 725, 270],
#                    [9.166995688, 546, 269],
#                    [9.062226583, 642, 274],
#                    [9.474354221, 352, 281],
#                    [8.406235467, 322, 280],
#                    [9.149617482, 675, 280],
#                    [9.184341013, 162, 283],
#                    [8.956231982, 239, 283],
#                    [9.356025796, 594, 299],
#                    [9.027033337, 89, 300],
#                    [9.079772052, 191, 299],
#                    [9.541311621, 557, 301],
#                    [8.991702347, 718, 303],
#                    [8.175883811, 494, 310],
#                    [7.377736139, 314, 306],
#                    [9.184341013, 341, 313],
#                    [9.389986074, 425, 314],
#                    [9.3219418, 678, 313],
#                    [9.541311621, 458, 314],
#                    [9.474354221, 115, 320],
#                    [9.440697439, 33, 322],
#                    [9.5246164, 147, 323],
#                    [9.57461473, 210, 325],
#                    [9.541311621, 578, 325],
#                    [9.607802402, 545, 331],
#                    [8.884866447, 391, 335],
#                    [9.201653641, 257, 338],
#                    [9.356025796, 485, 340],
#                    [9.270580849, 356, 343],
#                    [8.097643889, 443, 341],
#                    [9.57461473, 323, 351],
#                    [8.866935315, 229, 353],
#                    [9.5246164, 566, 354],
#                    [9.836981519, 276, 363],
#                    [10.04510995, 94, 363],
#                    [9.3219418, 643, 363],
#                    [8.866935315, 403, 366],
#                    [10.09253009, 207, 376],
#                    [10.32636489, 131, 376],
#                    [9.423823971, 363, 376],
#                    [9.70668462, 246, 379],
#                    [10.24901275, 333, 379],
#                    [9.541311621, 303, 381],
#                    [9.474354221, 483, 385],
#                    [10.02925341, 160, 389],
#                    [9.440697439, 631, 394],
#                    [8.195327082, 697, 396],
#                    [10.07674817, 101, 403],
#                    [10.01337177, 225, 403],
#                    [10.79358228, 133, 409],
#                    [10.38783189, 170, 419],
#                    [9.5246164, 679, 422],
#                    [10.98359899, 32, 423],
#                    [9.94959168, 428, 425],
#                    [10.88169461, 67, 426],
#                    [8.973984689, 638, 426],
#                    [9.440697439, 711, 427],
#                    [10.55502061, 214, 432],
#                    [10.18670815, 477, 439],
#                    [9.406920238, 608, 440],
#                    [8.884866447, 552, 448],
#                    [9.917547823, 412, 453],
#                    [10.89631073, 38, 456],
#                    [9.723067222, 680, 454],
#                    [9.853147481, 231, 458],
#                    [11.01254133, 173, 467],
#                    ]
#
# ger8um2_spheres = [[17.01010542, 33, 46],
#                    [17.10341444, 671, 94],
#                    [17.00074636, 547, 131],
#                    [16.57411934, 264, 136],
#                    [17.53531722, 575, 151],
#                    [17.2331983, 308, 158],
#                    [17.20546989, 185, 187],
#                    [20.3264909, 529, 297],
#                    [16.29326379, 558, 318],
#                    [15.917747, 731, 320],
#                    [17.2424312, 205, 324],
#                    [16.69848677, 405, 327],
#                    [16.93508806, 438, 334],
#                    [17.22396046, 372, 344],
#                    [16.7175381, 542, 347],
#                    [16.23454914, 738, 349],
#                    [17.5987363, 414, 359],
#                    [16.40036139, 503, 393],
#                    [17.06615205, 292, 396],
#                    [16.5260365, 732, 409],
#                    [16.95387352, 657, 415],
#                    [16.12635039, 701, 417],
#                    [9.788323439, 422, 417],
#                    [16.53566425, 493, 424],
#                    [13.35116236, 299, 424],
#                    [16.8597369, 463, 435],
#                    [17.25165915, 319, 446],
#                    [16.78404746, 532, 449],
#                    [16.7935273, 368, 454],
#                    [15.80737994, 585, 454],
#                    [17.10341444, 151, 457],
#                    [16.57411934, 502, 464],
#                    [16.57411934, 402, 464],
#                    [15.50238575, 465, 466],
#                    ]
# ger8um2_measure = [[9.201653641, 31, 45],
#                    [11.67204486, 670, 93],
#                    [11.38209663, 547, 131],
#                    [9.772050238, 262, 134],
#                    [11.87481703, 575, 150],
#                    [10.02925341, 306, 156],
#                    [10.31094089, 183, 186],
#                    [13.15904928, 529, 295],
#                    [9.59122292, 557, 317],
#                    [9.184341013, 731, 319],
#                    [10.83772799, 204, 322],
#                    [10.55502061, 405, 326],
#                    [10.21790794, 437, 333],
#                    [9.474354221, 373, 345],
#                    [9.94959168, 542, 346],
#                    [9.657370069, 738, 348],
#                    [10.55502061, 414, 358],
#                    [10.4184294, 503, 393],
#                    [10.47935641, 291, 395],
#                    [9.739422266, 732, 408],
#                    [10.28002345, 656, 415],
#                    [9.853147481, 701, 417],
#                    [5.836022432, 420, 418],
#                    [10.53993123, 493, 424],
#                    [8.444016491, 299, 424],
#                    [10.79358228, 462, 434],
#                    [11.34007028, 318, 444],
#                    [10.73443891, 531, 448],
#                    [11.34007028, 367, 454],
#                    [10.20231997, 585, 454],
#                    [10.04510995, 150, 455],
#                    [10.79358228, 502, 464],
#                    [10.67496788, 401, 463],
#                    [10.67496788, 465, 468],
#                    ]
#
# ge11um1_spheres = [[21.37228782, 240, 90],
#                    [22.25511588, 130, 139],
#                    [21.49851052, 204, 175],
#                    [18.3860028, 293, 277],
#                    ]
# ge11um1_measure = [[13.03754115, 240, 88],
#                    [14.01417853, 130, 137],
#                    [14.72307823, 205, 174],
#                    [10.99807968, 294, 277],
#                    ]
#
# ge11um2_spheres = [[21.95995168, 90, 20],
#                    [22.48987348, 236, 28],
#                    [22.09722529, 452, 27],
#                    [25.57590304, 545, 31],
#                    [22.82005639, 186, 40],
#                    [22.4260924, 637, 40],
#                    [22.14039803, 277, 44],
#                    [22.09002163, 594, 47],
#                    [22.24080851, 64, 54],
#                    [21.60927123, 498, 68],
#                    [23.51391657, 453, 76],
#                    [21.02694538, 639, 86],
#                    [22.04675024, 595, 90],
#                    [22.24080851, 531, 107],
#                    [21.10250058, 434, 117],
#                    [23.15240481, 346, 121],
#                    [20.61416256, 659, 122],
#                    [22.63096566, 594, 133],
#                    [22.03230756, 511, 145],
#                    [20.59098755, 22, 149],
#                    [22.16195286, 461, 150],
#                    [21.87280867, 157, 152],
#                    [22.44737289, 384, 160],
#                    [23.70939179, 107, 165],
#                    [20.80628379, 666, 178],
#                    [19.66587175, 550, 180],
#                    [22.68715685, 599, 191],
#                    [21.91642348, 236, 195],
#                    [22.13320842, 150, 198],
#                    [21.20782566, 24, 206],
#                    [21.53549405, 67, 218],
#                    [20.42023386, 206, 223],
#                    [22.3763592, 535, 232],
#                    [22.09002163, 304, 233],
#                    [21.67545598, 97, 247],
#                    [22.24080851, 437, 268],
#                    [22.16913314, 484, 268],
#                    [21.60927123, 132, 273],
#                    [23.20733348, 700, 275],
#                    [22.58873054, 370, 288],
#                    [22.02508267, 289, 301],
#                    [20.82921926, 333, 307],
#                    [22.11882219, 244, 308],
#                    [22.84096984, 151, 311],
#                    [22.26941406, 306, 342],
#                    [20.53681083, 583, 342],
#                    [23.53421343, 471, 350],
#                    [22.21216612, 523, 350],
#                    [20.05850683, 259, 353],
#                    [23.32362741, 348, 362],
#                    [21.70480665, 659, 367],
#                    [21.14770413, 557, 378],
#                    [22.48987348, 430, 379],
#                    [22.56758334, 208, 389],
#                    [21.95270297, 594, 408],
#                    [21.25280519, 398, 408],
#                    [22.14039803, 134, 412],
#                    [21.95995168, 328, 416],
#                    [21.50591232, 72, 419],
#                    [21.87280867, 541, 424],
#                    [22.44737289, 250, 437],
#                    [21.11757918, 482, 442],
#                    [20.56778643, 615, 445],
#                    [22.80610344, 49, 454],
#                    [20.2087007, 319, 456],
#                    ]
# ge11um2_measure = [[11.19884347, 90, 16],
#                    [11.35409635, 239, 25],
#                    [12.28327668, 451, 25],
#                    [13.9344548, 546, 28],
#                    [10.68986666, 184, 35],
#                    [11.72646029, 637, 36],
#                    [10.86705884, 276, 40],
#                    [10.86705884, 594, 44],
#                    [11.45179781, 63, 50],
#                    [9.723067222, 499, 66],
#                    [12.11366408, 451, 73],
#                    [11.2696781, 641, 82],
#                    [11.4656872, 595, 88],
#                    [11.75357352, 531, 104],
#                    [10.82303276, 435, 114],
#                    [11.01254133, 345, 117],
#                    [11.91495737, 660, 119],
#                    [10.80831755, 594, 130],
#                    [10.79358228, 511, 142],
#                    [10.21790794, 21, 144],
#                    [11.35409635, 461, 147],
#                    [10.94004192, 156, 148],
#                    [10.92548431, 385, 157],
#                    [11.36810511, 106, 160],
#                    [11.54867275, 667, 175],
#                    [10.18670815, 550, 177],
#                    [10.96909919, 599, 187],
#                    [10.63014626, 237, 193],
#                    [10.64510777, 150, 194],
#                    [11.4100282, 23, 203],
#                    [10.26452982, 67, 215],
#                    [10.10828737, 205, 220],
#                    [11.39607097, 535, 230],
#                    [11.35409635, 303, 230],
#                    [11.39607097, 96, 244],
#                    [11.14185153, 437, 264],
#                    [11.68567247, 484, 266],
#                    [8.574939283, 135, 272],
#                    [10.68986666, 699, 273],
#                    [11.94164264, 369, 286],
#                    [10.74925526, 289, 298],
#                    [11.28379167, 332, 306],
#                    [10.88169461, 243, 305],
#                    [11.86140673, 150, 307],
#                    [11.72646029, 306, 338],
#                    [8.368283872, 585, 341],
#                    [12.2962269, 471, 348],
#                    [11.17038385, 524, 348],
#                    [9.885400096, 259, 349],
#                    [11.07019901, 347, 359],
#                    [10.80831755, 661, 365],
#                    [10.55502061, 554, 375],
#                    [11.87481703, 429, 377],
#                    [11.83454055, 207, 386],
#                    [11.08456657, 592, 406],
#                    [11.19884347, 398, 405],
#                    [10.74925526, 134, 408],
#                    [11.67204486, 328, 413],
#                    [11.34007028, 72, 416],
#                    [10.71960209, 541, 421],
#                    [11.07019901, 249, 432],
#                    [10.88169461, 480, 440],
#                    [10.23347217, 616, 442],
#                    [12.76615297, 46, 453],
#                    [10.58513486, 319, 455],
#                    ]
#
# ge11um3_spheres = [[21.96719799, 195, 18],
#                    [20.98148166, 407, 16],
#                    [22.16913314, 262, 39],
#                    [22.60281769, 615, 51],
#                    [22.58873054, 417, 55],
#                    [22.29084414, 301, 60],
#                    [27.62225185, 373, 74],
#                    [22.46863324, 78, 100],
#                    [22.81308098, 151, 103],
#                    [22.75720072, 477, 122],
#                    [22.53935621, 117, 132],
#                    [23.38496065, 722, 135],
#                    [19.19074095, 551, 134],
#                    [22.48987348, 674, 138],
#                    [22.48279563, 257, 154],
#                    [23.52068414, 526, 170],
#                    [22.47571555, 423, 182],
#                    [22.12601647, 618, 192],
#                    [22.11882219, 416, 224],
#                    [22.91748922, 543, 234],
#                    [23.35090651, 381, 249],
#                    [22.36924543, 614, 280],
#                    [22.41189417, 271, 285],
#                    [22.45446191, 232, 304],
#                    [22.79214194, 569, 307],
#                    [22.74320921, 161, 314],
#                    [23.00759311, 608, 329],
#                    [21.95995168, 655, 336],
#                    [21.59453596, 679, 371],
#                    [21.93094248, 721, 376],
#                    [22.50402251, 326, 380],
#                    [27.31516746, 448, 401],
#                    [22.60281769, 146, 415],
#                    [22.54641631, 56, 430],
#                    [22.59577521, 23, 459],
#                    ]
# ge11um3_measure = [[10.73443891, 192, 13],
#                    [9.097283683, 406, 7],
#                    [11.08456657, 261, 36],
#                    [12.53974018, 614, 51],
#                    [10.98359899, 416, 51],
#                    [10.66004828, 299, 56],
#                    [13.45802085, 374, 70],
#                    [12.36077446, 75, 98],
#                    [10.7047447, 150, 99],
#                    [11.22723096, 476, 118],
#                    [10.95458019, 116, 127],
#                    [11.43789155, 719, 131],
#                    [10.0609415, 549, 132],
#                    [10.83772799, 675, 135],
#                    [11.38209663, 256, 150],
#                    [11.22723096, 525, 166],
#                    [11.6447418, 422, 179],
#                    [12.21831971, 616, 191],
#                    [11.43789155, 415, 221],
#                    [11.98155911, 542, 231],
#                    [12.8778667, 381, 245],
#                    [10.86705884, 613, 277],
#                    [11.02698402, 270, 281],
#                    [11.15612681, 231, 300],
#                    [11.54867275, 568, 303],
#                    [10.7047447, 160, 310],
#                    [12.37364357, 607, 325],
#                    [11.01254133, 654, 334],
#                    [10.4031419, 678, 368],
#                    [10.26452982, 719, 372],
#                    [11.36810511, 325, 376],
#                    [14.85223051, 447, 398],
#                    [11.31196598, 144, 411],
#                    [12.16610443, 55, 426],
#                    [11.68567247, 23, 455],
#                    ]
#
# ger22um_spheres = [[40.1408102, 63, 52],
#                    [37.35173665, 228, 140],
#                    [38.33584151, 300, 158],
#                    [39.50132988, 56, 195],
#                    [38.94543115, 692, 194],
#                    [40.43314946, 530, 317],
#                    ]
# ger22um_measure = [[29.68302149, 65, 52],
#                    [27.56457325, 230, 139],
#                    [27.94874703, 302, 157],
#                    [28.04538694, 58, 194],
#                    [28.02835705, 693, 193],
#                    [31.85548488, 530, 317],
#                    ]
#
# spheres_radii = [alumina_spheres, corp151_spheres, corp152_spheres, gadi_1__spheres, gadi_2__spheres, ger8um1_spheres,
#                  ger8um2_spheres, ge11um1_spheres, ge11um2_spheres, ge11um3_spheres, ger22um_spheres]
# measure_radii = [alumina_measure, corp151_measure, corp152_measure, gadi_1__measure, gadi_2__measure, ger8um1_measure,
#                  ger8um2_spheres, ge11um1_measure, ge11um2_measure, ge11um3_measure, ger22um_measure]
#
# for f, s, m in zip(folder_name_list, spheres_radii, measure_radii):
#     np.savez(default_path + f + '\\measure_locations', spheres=s, measure=m)


def sinusoid(angle, phase, amplitude, constant):
    return amplitude * (1. + constant * np.cos(2. * angle + phase))


def get_circ_pts(folder_name, measure_locations):
    # First we import all the images and their fits, as well as the locations of the spheres

    path_name = default_path + folder_name + "\\"

    npzfile_im_stack = np.load(path_name + 'aligned_image_stack.npz')
    image_stack = npzfile_im_stack['image_stack']

    n, nj, nk = image_stack.shape
    if debugging:
        print nj, nk

    npzfile_s_bg_loc = np.load(path_name + 'sphere_locations.npz')
    backgroundcoords = npzfile_s_bg_loc['background']

    if fit:
        background = [np.median(np.ravel(im)) for im in image_stack]
        min_bg = float(np.min(background))
        npzfile = np.load(path_name + 'aligned_simple_intensity_sinusoid_amplitudes.npz')
        constant = np.array(npzfile['constant'])
        amplitude = np.array(npzfile['amplitudes'])
        new_constant = amplitude * constant / (amplitude + min_bg)
        circularity_squared = 1 - new_constant ** 2
    else:
        brightest_pixels_im = np.array(np.max(image_stack, axis=0), dtype=float)
        darkest_pixels_im = np.array(np.min(image_stack, axis=0), dtype=float)
        constant_ar = (brightest_pixels_im - darkest_pixels_im) / (brightest_pixels_im + darkest_pixels_im)
        circularity_squared = 1 - constant_ar ** 2

    background_circularity_squared = np.median(circularity_squared[backgroundcoords])
    bg_circ = np.sqrt(np.abs(background_circularity_squared))
    print folder_name
    print 'bg_circ = ' + str(bg_circ)
    print '     or = ' + str(background_circularity_squared)
    print ''

    delta_circ = []
    for radius, x, y in measure_locations:
        cj, ck = circle(y, x, radius)
        ck = ck[cj < nj]
        cj = cj[cj < nj]
        cj = cj[ck < nk]
        ck = ck[ck < nk]

        if debugging:
            image2 = gray2rgb(image_stack[0])
            image2[cj, ck] = (220, 20, 20)
            plt.figure()
            plt.imshow(image2)
            plt.ylabel(folder_name)
            plt.show()

        curr_circ_squared = np.median(circularity_squared[cj, ck])
        curr_circ = np.sqrt(curr_circ_squared)

        delta_circ.append(curr_circ)

    return delta_circ, bg_circ / (2. * np.sqrt(delta_circ))


# if debugging:
#     print get_circ_pts(folder_name_list[-2], measure_radii[-2])

# now to actually make the scatter plot:
diameters_in_micron_list = [[], [], [], [], [], []]
delta_circularity_list = [[], [], [], [], [], []]
error_list = [[], [], [], [], [], []]

marker_list = ['o', 's', '*', '^', 'v', 'd']
indexing = [0, 1, 1, 2, 2, 3, 3, 4, 4, 4, 5]

# plt.figure(figsize=(5, 4))
for folder, i in zip(folder_name_list, indexing):
    f = np.load(default_path + folder + '\\measure_locations.npz')
    sphere_list = f['spheres']
    measure_list = f['measure']
    radii_in_pixels, _, _ = zip(*sphere_list)
    diameters_in_micron = 2 * np.array(radii_in_pixels) * micron_per_pixel
    delta_circ_pts, error = get_circ_pts(folder, measure_list)
    # delta_circ_pts = get_circ_pts(folder, sphere_list)
    diameters_in_micron_list[i].extend(diameters_in_micron)
    delta_circularity_list[i].extend(np.array(delta_circ_pts) - np.median(error))
    error_list[i].extend(error)
    # print 'Sample ' + str(i + 1)
    # print np.average(error), np.median(error), max(error)
    # print ''

#     plt.plot(diameters_in_micron, delta_circ_pts, marker_list[i], fillstyle='none', label=folder)
# plt.ylabel('$\\Delta$ Circularity of light through sphere')
# plt.xlabel('Diameter of microsphere [um]')
# legend = plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)
# if save_images:
#     if fit:
#         save_name = default_path + 'scatter_plot_diameter_circularity_separated_fit_full.png'
#     else:
#         save_name = default_path + 'scatter_plot_diameter_circularity_separated_full.png'
#     plt.savefig(save_name, bbox_inches="tight")
# plt.show()

# if show_all_plots:
#     sphere_labels = ['Alumina', '15um Corpuscular silica', 'House-made vaterite', '8um microParticles vaterite',
#                      '11um microParticles vaterite', '22um microParticles silica']
sphere_labels = ['Sample ' + str(i + 1) for i in range(6)]

plt.figure(figsize=(5, 4))
for d, c, m, e, l in zip(diameters_in_micron_list, delta_circularity_list, marker_list, error_list, sphere_labels):
    # d = np.array(d)
    c = np.array(c)
    e = np.array(e)
    # plt.plot(d[c>=-0.09], c[c>=-0.09], m, fillstyle='none', label=l)
    print l
    print np.average(e), np.median(e), max(e)
    print ''
    # plt.errorbar(d, np.abs(c), fmt=m, yerr=e, fillstyle='none', label=l)
    plt.plot(d, c, m, fillstyle='none', label=l)
plt.ylabel('$\\Delta$ Circularity of light through sphere')
plt.xlabel('Diameter of microsphere [$\mu$m]')
plt.legend()
plt.tight_layout()
plt.savefig(default_path + 'scatter_plot_diameter_circularity_new.png')
# if save_images:
#     plt.tight_layout()
#     if fit:
#         save_name = default_path + 'scatter_plot_diameter_circularity_fit_full.png'
#     else:
#         save_name = default_path + 'scatter_plot_diameter_circularity_full.png'
#     plt.savefig(save_name)
plt.show()
